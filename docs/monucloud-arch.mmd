flowchart TD
  B[Browser &#40;Flask UI&#41;]
  A[Flask API server &#40;app.py&#41;]
  Q[(Celery Broker)]
  W[Celery Worker &#40;scan tasks&#41;]
  D[(PostgreSQL)]
  C[(AWS APIs)]

  B -->|HTTP/HTTPS| A
  A -->|enqueue| Q
  W -->|consume| Q
  W -->|STS AssumeRole &#40;External ID&#41;| C
  A -->|read/write| D
  W -->|read/write| D



sequenceDiagram
  participant UI as "UI"
  participant API as "Flask API"
  participant DB as "Postgres"
  participant W as "Celery Worker"
  participant AWS as "AWS STS + Services"

  UI->>API: POST /api/scans {account:"ALL"}
  API->>DB: insert scan rows &#40;per account&#41;
  API->>W: enqueue tasks &#40;job_id, account_id&#41;
  loop for each account
    W->>DB: fetch role_arn, external_id
    W->>AWS: STS AssumeRole&#40;RoleArn, ExternalId&#41;
    W->>AWS: Call service APIs &#40;EC2&#47;S3&#47;IAM&#41;
    W->>DB: Upsert findings &amp; resources
  end
  UI->>API: GET /api/findings?account=...
  API->>DB: query findings with filters
  API-->>UI: JSON -&gt; charts&#47;table
