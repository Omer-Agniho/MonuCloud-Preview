```mermaid
flowchart TD
  B[Browser &#40;Flask UI&#41;]
  A[Flask API server &#40;app.py&#41;]
  Q[(Celery Broker)]
  W[Celery Worker &#40;scan tasks&#41;]
  D[(PostgreSQL)]
  C[(AWS APIs)]

  B -->|HTTP/HTTPS| A
  A -->|enqueue| Q
  W -->|consume| Q
  W -->|STS AssumeRole &#40;External ID&#41;| C
  A -->|read/write| D
  W -->|read/write| D



sequenceDiagram
  participant U as UI
  participant A as API
  participant D as Postgres
  participant W as Celery Worker
  participant S as AWS STS + Services

  U->>A: POST /api/scans {account:"ALL"}
  A->>D: insert scan rows (per account)
  A->>W: enqueue tasks (job_id, account_id)
  loop for each account
    W->>S: STS AssumeRole (RoleArn, ExternalId)
    W->>S: Call service APIs (EC2/S3/IAM)
    W->>D: Upsert findings & resources
  end
  U->>A: GET /api/findings?account=...
  A->>D: query findings with filters
  A-->>U: JSON -> charts/table


```mermaid